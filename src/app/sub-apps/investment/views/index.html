{% extends 'layout-investment.html' %}

{% if tab.isOverseasRegions %}
	{% set pageName='Investment Homepage with overseas markets' %}

{% else %}
	{% set pageName='Investment Homepage' %}
{% endif %}

{% from 'macros/dates.html' import financialYear %}
{% from 'macros/pie-charts.html' import fdiStagePieChart, fdiHvcPieChart %}
{% from 'macros/page-heading.html' import pageHeading %}
{% from './macros/headline-figures.html' import headlineFigure, headlineSubFigure, headlineBreakdown %}
{% from './macros/table-data.html' import dataTable %}

{% block page_heading %}
	{{ pageHeading( 'Investment performance' ) }}
{% endblock %}

{% block page_content %}

	<h2 class="fdi-overview-heading">Headlines</h2>
	<h3 class="fdi-overview-sub-heading">On <span class="fdi-page-date_emphasize">{{ null | dateOnly }}</span> at {{ null | timeOnly }} releated to <span class="fdi-page-date_emphasize">financial year {{ selectedYear }}/{{ ( selectedYear - 2000 ) + 1  }}</span></h3>

	<section class="grid-row fdi-section">

		<div class="column-one-quarter fdi-section-row">

			{{ headlineFigure( 'Project wins', 'Total', headlines.wins.total | largeNumber ) }}

			{{ headlineBreakdown( [
				[ 'High', headlines.wins.percentage.high + '%' ],
				[ 'Good', headlines.wins.percentage.good + '%' ],
				[ 'Standard', headlines.wins.percentage.standard + '%' ]
			] ) }}

		</div>
		<div class="column-one-quarter fdi-section-row">

			{{ fdiHvcPieChart(
				'Non-HVC', headlines.breakdown.type.nonHvc,
				'HVC', headlines.breakdown.type.hvc
			) }}

			{{ fdiStagePieChart(
				'Verify win', headlines.breakdown.stage.verify,
				'Won', headlines.breakdown.stage.won,
				'perf-stage'
			) }}

		</div>
		<div class="column-one-quarter fdi-section-row">

			{{ headlineSubFigure( 'Jobs', 'Total', headlines.jobs.total | largeNumber ) }}

			{{ headlineBreakdown( [
				[ 'New jobs', headlines.jobs.new | largeNumber ],
				[ 'Safeguarded jobs', headlines.jobs.safeguarded | largeNumber ]
			], 'jobs' ) }}

		</div>
		<div class="column-one-quarter">

			{{ headlineSubFigure( 'Pipeline', 'Active', headlines.pipeline.total | largeNumber ) }}

			{{ headlineBreakdown( [
				[ 'High', headlines.pipeline.percentage.high + '%' ],
				[ 'Good', headlines.pipeline.percentage.good + '%' ],
				[ 'Standard', headlines.pipeline.percentage.standard + '%' ]
			] )}}
		</div>
	</section>

	<section class="grid-row fdi-section">
		<div class="column-single">

			<h2 class="fdi-overview-heading">Investment wins</h2>
			<p class="fdi-overview-sub-heading">Verified won in all of the department</p>

			{{ dataTable( 'fdi-wins', details.wins ) }}
		</div>
	</section>

	<h2 class="fdi-overview-heading">Investment pipeline</h2>
	<p class="fdi-overview-sub-heading">Active in all of the department</p>
	<section class="grid-row">
		<div class="column-three-quarters">

			{{ dataTable( 'fdi-active-pipeline', details.activePipeline ) }}

		</div>
		<div class="column-one-quarter">

			<div class="fdi-pipeline-projects">
				<h3 class="fdi-pipeline-projects-heading">All pipeline projects</h3>

				{% macro projectDetail( name, value1, value2 ) %}
					<dl class="fdi-pipeline-projects-list_detail">
						<dt class="fdi-pipeline-projects-list_detail_term">{{ name }}</dt>
						<dd class="fdi-pipeline-projects-list_detail_value">{{ value1 }}</dd>
						<dd class="fdi-pipeline-projects-list_detail_value">{{ value2 }}%</dd>
					</dl>
				{% endmacro %}

				<ol class="fdi-pipeline-projects-list">
					<li class="fdi-pipeline-projects-list_item">
						<span class="position-marker" data-number="1"></span>
						{{ projectDetail(
							'Prospect',
							details.pipeline.prospect.count,
							details.pipeline.prospect.percent
						) }}
					</li>
					<li class="fdi-pipeline-projects-list_item">
						<span class="position-marker" data-number="2"></span>
						{{ projectDetail(
							'Assign PM',
							details.pipeline.assign.count,
							details.pipeline.assign.percent
						) }}
					</li>
					<li class="fdi-pipeline-projects-list_item">
						<span class="position-marker" data-number="3"></span>
						{{ projectDetail(
							'Active',
							details.pipeline.active.count,
							details.pipeline.active.percent
						) }}
					</li>
				</ol>
			</div>
		</div>
	</section>

	<nav class="page-nav page-nav--divider" id="page-tabs">
		<ul class="page-nav_list">
			<li class="page-nav_list_item">
				<a class="page-nav_link{% if tab.isSectors %} page-nav_link--active{% endif %}" href="{{ urls.investment.index() }}#page-tabs">Sectors</a>
			</li>
			<li class="page-nav_list_item">
				<a class="page-nav_link{% if tab.isOverseasRegions %} page-nav_link--active{% endif %}" href="{{ urls.investment.index({ osRegions: true } ) }}#page-tabs">Overseas markets</a>
			</li>
			{#
			<li class="page-nav_list_item">
				<a class="page-nav_link{% if tab.isUkRegions %} page-nav_link--active{% endif %}" href="#page-tabs">UK regions</a>
			</li>
			#}
		</ul>
	</nav>

	<h2 class="fdi-overview-heading">{{ progressHeading }}</h2>

	<p class="visually-hidden">Project broken down by:</p>
	<ul class="key-fdi-win-progress">
		<li class="key-fdi-win-progress_item">Won<span class="key-fdi-win-progress_block key-fdi-win-progress_block--won"></span></li>
		<li class="key-fdi-win-progress_item">Verify win<span class="key-fdi-win-progress_block key-fdi-win-progress_block--verify-win"></span></li>
		<li class="key-fdi-win-progress_item">Active pipeline<span class="key-fdi-win-progress_block key-fdi-win-progress_block--pipeline"></span></li>
		<li class="key-fdi-win-progress_item">Target<span class="key-fdi-win-progress_target"></span></li>
	</ul>

	{% macro sortedHeading( name, key, rows ) %}
		<a class="sort-heading{% if rows.sortKey == key %} sort-heading--{{ rows.sortDir }}{% endif %}" href="{{ urls.addSort( urls.current( { query: { tab: tab.selected } } ), key, rows.sortKey, rows.sortDir ) }}#page-tabs" title="Sort by {{ name }}">{{ name }}</a>
	{% endmacro %}


	<div class="table-fdi-win-progress-wrapper">
		<table class="table-fdi-win-progress">
			<thead>
				<tr>
					<th class="table-fdi-win-progress_heading">{{ sortedHeading( progressColumnHeading, progressColumnHeadingKey, progressRows ) }}</th>
					<th class="table-fdi-win-progress_heading">{{ sortedHeading( 'Project wins', sortKeys.projectWins, progressRows ) }}</th>
					<th class="table-fdi-win-progress_heading">{{ sortedHeading( 'HVC wins', sortKeys.hvcWins, progressRows ) }}</th>
					<th class="table-fdi-win-progress_heading"><span class="visually-hidden">Project breakdown</span></th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td colspan="3"></td>
					<td class="table-fdi-win-progress_scale-cell">
						<span class="visually-hidden">Scale for graph:</span>
						<span class="table-fdi-win-progress_scale">
							{% for point in progressRows.scale %}
								<span class="table-fdi-win-progress_scale-point">
									<span class="table-fdi-win-progress_scale-point_value">{{ point }}</span>
								</span>
							{% endfor %}
						</span>
					</td>
				</tr>
				{% for row in progressRows %}
				<tr>
					<td class="table-fdi-win-progress_cell table-fdi-win-progress_cell--name">{{ row.name }}</td>
					<td class="table-fdi-win-progress_cell table-fdi-win-progress_cell--total">{{ row.wins.total }}</td>
					<td class="table-fdi-win-progress_cell table-fdi-win-progress_cell--hvc">{{ row.wins.hvc }}</td>
					<td class="table-fdi-win-progress_cell table-fdi-win-progress_cell--progress">
						<div class="table-fdi-win-progress_segments">
							<span class="visually-hidden">Won: {{ row.segments.won.count }}</span>
							<span class="table-fdi-win-progress_segment table-fdi-win-progress_segment--won" style="left: {{ row.segments.won.start }}%; width: {{ row.segments.won.percent }}%;"></span>

							<span class="visually-hidden">Verify win: {{ row.segments.verifyWin.count }}</span>
							<span class="table-fdi-win-progress_segment table-fdi-win-progress_segment--verify-win" style="left: {{ row.segments.verifyWin.start }}%; width: {{ row.segments.verifyWin.percent }}%;"></span>

							<span class="visually-hidden">Active pipeline: {{ row.segments.pipeline.count }}</span>
							<span class="table-fdi-win-progress_segment table-fdi-win-progress_segment--pipeline" style="left: {{ row.segments.pipeline.start }}%; width: {{ row.segments.pipeline.percent }}%;"></span>

							<span class="visually-hidden">Target: {{ row.segments.target.count }}</span>
							{% if row.segments.target.percent %}
							<span class="table-fdi-win-progress_target" style="left: {{ row.segments.target.percent }}%;"></span>
							{% endif %}
						</div>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>

{% endblock %}
